name: iOS CI Pipeline

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main ]

jobs:
  build-and-test:
    runs-on: macos-latest
    
    steps:
    - name: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
      uses: actions/checkout@v3
      
    - name: ØªØ­Ø¯ÙŠØ¯ Ø¥ØµØ¯Ø§Ø± Xcode
      run: sudo xcode-select -s /Applications/Xcode.app/Contents/Developer
      
    - name: Ø¥Ø¸Ù‡Ø§Ø± Ø¥ØµØ¯Ø§Ø± Xcode
      run: xcodebuild -version
      
    - name: Ø¨Ù†Ø§Ø¡ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹
      run: |
        make build
      
    - name: ØªØ´ØºÙŠÙ„ Ø§Ù„Ø§Ø®ØªØ¨Ø§Ø±Ø§Øª
      run: |
        make test
      
    - name: ÙØ­Øµ Ø§Ù„ÙƒÙˆØ¯
      run: |
        make lint || true
        
    - name: Ø¥Ù†Ø´Ø§Ø¡ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      run: |
        make archive
        
    - name: Ø±ÙØ¹ Ø§Ù„Ø£Ø±Ø´ÙŠÙ
      if: github.event_name == 'push' && github.ref == 'refs/heads/main'
      uses: actions/upload-artifact@v3
      with:
        name: app-archive
        path: build/SimpleTableApp.xcarchive

  code-quality:
    runs-on: ubuntu-latest
    
    steps:
    - name: Ø§Ù„ØªØ­Ù‚Ù‚ Ù…Ù† Ø§Ù„ÙƒÙˆØ¯
      uses: actions/checkout@v3
      
    - name: ÙØ­Øµ Ø§Ù„Ù…Ù„ÙØ§Øª
      run: |
        echo "ğŸ“ Ù‡ÙŠÙƒÙ„ Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:"
        find . -type f -name "*.swift" | head -10
        echo ""
        echo "ğŸ“Š Ø­Ø¬Ù… Ø§Ù„Ù…Ø´Ø±ÙˆØ¹:"
        find . -name "*.swift" -exec wc -l {} + | tail -1
